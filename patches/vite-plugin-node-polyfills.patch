diff --git a/dist/index.cjs b/dist/index.cjs
index 797a573d7d9aba06d921fc8d62fb58a7cec67361..18682611967bcec490f0ec9b8348615488014074 100644
--- a/dist/index.cjs
+++ b/dist/index.cjs
@@ -1,3 +1,3 @@
-"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const T=require("node:module"),x=require("@rollup/plugin-inject"),O=require("node-stdlib-browser"),P=require("node-stdlib-browser/helpers/rollup/plugin"),R=require("node-stdlib-browser/helpers/esbuild/plugin");var h=typeof document<"u"?document.currentScript:null;const g=l=>l&&l.__esModule?l:{default:l},S=g(x),q=g(O),w=g(R),_=(l,e)=>b(l)===b(e),s=(l,e)=>l?l===!0?!0:l===e:!1,$=l=>l.startsWith("node:"),I=l=>{const e=l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`^${e}$`)},b=l=>l.replace(/^node:/,""),a={buffer:["import __buffer_polyfill from 'vite-plugin-node-polyfills/shims/buffer'","globalThis.Buffer = globalThis.Buffer || __buffer_polyfill"],global:["import __global_polyfill from 'vite-plugin-node-polyfills/shims/global'","globalThis.global = globalThis.global || __global_polyfill"],process:["import __process_polyfill from 'vite-plugin-node-polyfills/shims/process'","globalThis.process = globalThis.process || __process_polyfill"]},D=(l={})=>{const e={include:[],exclude:[],overrides:{},protocolImports:!0,...l,globals:{Buffer:!0,global:!0,process:!0,...l.globals}},y=o=>e.include.length>0?!e.include.some(r=>_(o,r)):e.exclude.some(r=>_(o,r)),B=o=>{if(s(e.globals.Buffer,"dev")&&/^buffer$/.test(o))return"vite-plugin-node-polyfills/shims/buffer";if(s(e.globals.global,"dev")&&/^global$/.test(o))return"vite-plugin-node-polyfills/shims/global";if(s(e.globals.process,"dev")&&/^process$/.test(o))return"vite-plugin-node-polyfills/shims/process";if(o in e.overrides)return e.overrides[o]},u=Object.entries(q.default).reduce((o,[r,i])=>(!e.protocolImports&&$(r)||y(r)||(o[r]=B(b(r))||i),o),{}),f=T.createRequire(typeof document>"u"?require("url").pathToFileURL(__filename).href:h&&h.src||new URL("index.cjs",document.baseURI).href),p=[...s(e.globals.Buffer,"dev")?[f.resolve("vite-plugin-node-polyfills/shims/buffer")]:[],...s(e.globals.global,"dev")?[f.resolve("vite-plugin-node-polyfills/shims/global")]:[],...s(e.globals.process,"dev")?[f.resolve("vite-plugin-node-polyfills/shims/process")]:[]],d=[...s(e.globals.Buffer,"dev")?a.buffer:[],...s(e.globals.global,"dev")?a.global:[],...s(e.globals.process,"dev")?a.process:[],""].join(`
-`);return{name:"vite-plugin-node-polyfills",config(o,r){const i=r.command==="serve",v=!!this?.meta?.rolldownVersion,m={...i&&s(e.globals.Buffer,"dev")?{Buffer:"Buffer"}:{},...i&&s(e.globals.global,"dev")?{global:"global"}:{},...i&&s(e.globals.process,"dev")?{process:"process"}:{}},c={...s(e.globals.Buffer,"build")?{Buffer:"vite-plugin-node-polyfills/shims/buffer"}:{},...s(e.globals.global,"build")?{global:"vite-plugin-node-polyfills/shims/global"}:{},...s(e.globals.process,"build")?{process:"vite-plugin-node-polyfills/shims/process"}:{}};return{build:{rollupOptions:{onwarn:(t,n)=>{P.handleCircularDependancyWarning(t,()=>{if(o.build?.rollupOptions?.onwarn)return o.build.rollupOptions.onwarn(t,n);n(t)})},...Object.keys(c).length>0?v?{inject:c}:{plugins:[S.default(c)]}:{}}},esbuild:{banner:i?d:void 0},optimizeDeps:{exclude:[...p],...v?{rollupOptions:{define:m,resolve:{alias:{...u}},plugins:[{name:"vite-plugin-node-polyfills:optimizer",banner:i?d:void 0}]}}:{esbuildOptions:{banner:i?{js:d}:void 0,define:m,inject:[...p],plugins:[w.default(u),{name:"vite-plugin-node-polyfills-shims-resolver",setup(t){for(const n of p){const j=I(n);t.onResolve({filter:j},()=>({external:!1,path:n}))}}}]}}},resolve:{alias:{...u}}}}}};exports.nodePolyfills=D;
+"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const R=require("node:module"),T=require("@rollup/plugin-inject"),w=require("node-stdlib-browser"),O=require("node-stdlib-browser/helpers/rollup/plugin"),S=require("node-stdlib-browser/helpers/esbuild/plugin");var _=typeof document<"u"?document.currentScript:null;const v=e=>e&&e.__esModule?e:{default:e},q=v(T),$=v(w),I=v(S),B=(e,l)=>b(e)===b(l),o=(e,l)=>e?e===!0?!0:e===l:!1,M=e=>e.startsWith("node:"),D=e=>{const l=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`^${l}$`)},b=e=>e.replace(/^node:/,""),g={buffer:["import __buffer_polyfill from 'vite-plugin-node-polyfills/shims/buffer'","globalThis.Buffer = globalThis.Buffer || __buffer_polyfill"],global:["import __global_polyfill from 'vite-plugin-node-polyfills/shims/global'","globalThis.global = globalThis.global || __global_polyfill"],process:["import __process_polyfill from 'vite-plugin-node-polyfills/shims/process'","globalThis.process = globalThis.process || __process_polyfill"]},E=(e={})=>{const l={include:[],exclude:[],overrides:{},protocolImports:!0,...e,globals:{Buffer:!0,global:!0,process:!0,...e.globals}},j=s=>l.include.length>0?!l.include.some(i=>B(s,i)):l.exclude.some(i=>B(s,i)),x=s=>{if(o(l.globals.Buffer,"dev")&&/^buffer$/.test(s))return"vite-plugin-node-polyfills/shims/buffer";if(o(l.globals.global,"dev")&&/^global$/.test(s))return"vite-plugin-node-polyfills/shims/global";if(o(l.globals.process,"dev")&&/^process$/.test(s))return"vite-plugin-node-polyfills/shims/process";if(s in l.overrides)return l.overrides[s]},p=Object.entries($.default).reduce((s,[i,r])=>(!l.protocolImports&&M(i)||j(i)||(s[i]=x(b(i))||r),s),{}),t=R.createRequire(typeof document>"u"?require("url").pathToFileURL(__filename).href:_&&_.src||new URL("index.cjs",document.baseURI).href),d=[...o(l.globals.Buffer,"dev")?[t.resolve("vite-plugin-node-polyfills/shims/buffer")]:[],...o(l.globals.global,"dev")?[t.resolve("vite-plugin-node-polyfills/shims/global")]:[],...o(l.globals.process,"dev")?[t.resolve("vite-plugin-node-polyfills/shims/process")]:[]],a=[...o(l.globals.Buffer,"dev")?g.buffer:[],...o(l.globals.global,"dev")?g.global:[],...o(l.globals.process,"dev")?g.process:[],""].join(`
+`);return{name:"vite-plugin-node-polyfills",config(s,i){const r=i.command==="serve",m=!!this?.meta?.rolldownVersion,h={...r&&o(l.globals.Buffer,"dev")?{Buffer:"Buffer"}:{},...r&&o(l.globals.global,"dev")?{global:"global"}:{},...r&&o(l.globals.process,"dev")?{process:"process"}:{}},c={...o(l.globals.Buffer,"build")?{Buffer:"vite-plugin-node-polyfills/shims/buffer"}:{},...o(l.globals.global,"build")?{global:"vite-plugin-node-polyfills/shims/global"}:{},...o(l.globals.process,"build")?{process:"vite-plugin-node-polyfills/shims/process"}:{}},u=new Map;o(l.globals.Buffer,"build")&&u.set("vite-plugin-node-polyfills/shims/buffer",t.resolve("vite-plugin-node-polyfills/shims/buffer")),o(l.globals.global,"build")&&u.set("vite-plugin-node-polyfills/shims/global",t.resolve("vite-plugin-node-polyfills/shims/global")),o(l.globals.process,"build")&&u.set("vite-plugin-node-polyfills/shims/process",t.resolve("vite-plugin-node-polyfills/shims/process"));const y=u.size>0?{name:"vite-plugin-node-polyfills:shims-resolver",resolveId(n){return u.has(n)?{id:u.get(n),external:!1}:null}}:null;return{build:{rollupOptions:{onwarn:(n,f)=>{O.handleCircularDependancyWarning(n,()=>{if(s.build?.rollupOptions?.onwarn)return s.build.rollupOptions.onwarn(n,f);f(n)})},...Object.keys(c).length>0?m?{inject:c}:{plugins:[q.default(c),...y?[y]:[]]}:{}}},esbuild:{banner:r?a:void 0},optimizeDeps:{exclude:[...d],...m?{rollupOptions:{define:h,resolve:{alias:{...p}},plugins:[{name:"vite-plugin-node-polyfills:optimizer",banner:r?a:void 0}]}}:{esbuildOptions:{banner:r?{js:a}:void 0,define:h,inject:[...d],plugins:[I.default(p),{name:"vite-plugin-node-polyfills-shims-resolver",setup(n){for(const f of d){const P=D(f);n.onResolve({filter:P},()=>({external:!1,path:f}))}}}]}}},resolve:{alias:{...p}}}}}};exports.nodePolyfills=E;
 //# sourceMappingURL=index.cjs.map
diff --git a/dist/index.cjs.map b/dist/index.cjs.map
index 20e4b7c02620c532ec5da96e80cd72da45691819..5468b8d3ccec38f7f6fb6dd075f0551c3c369417 100644
--- a/dist/index.cjs.map
+++ b/dist/index.cjs.map
@@ -1 +1 @@
-{"version":3,"file":"index.cjs","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["import type { BooleanOrBuildTarget, ModuleName, ModuleNameWithoutNodePrefix } from './index'\n\nexport const compareModuleNames = (moduleA: ModuleName, moduleB: ModuleName) => {\n  return withoutNodeProtocol(moduleA) === withoutNodeProtocol(moduleB)\n}\n\nexport const isEnabled = (value: BooleanOrBuildTarget, mode: 'build' | 'dev') => {\n  if (!value) return false\n  if (value === true) return true\n\n  return value === mode\n}\n\nexport const isNodeProtocolImport = (name: string) => {\n  return name.startsWith('node:')\n}\n\nexport const toRegExp = (text: string) => {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#escaping\n  const escapedText = text.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n\n  return new RegExp(`^${escapedText}$`)\n}\n\nexport const withoutNodeProtocol = (name: ModuleName): ModuleNameWithoutNodePrefix => {\n  return name.replace(/^node:/, '') as ModuleNameWithoutNodePrefix\n}\n","import { createRequire } from 'node:module'\nimport inject from '@rollup/plugin-inject'\nimport stdLibBrowser from 'node-stdlib-browser'\nimport { handleCircularDependancyWarning } from 'node-stdlib-browser/helpers/rollup/plugin'\nimport esbuildPlugin from 'node-stdlib-browser/helpers/esbuild/plugin'\nimport type { Plugin } from 'vite'\nimport { compareModuleNames, isEnabled, isNodeProtocolImport, toRegExp, withoutNodeProtocol } from './utils'\n\nexport type BuildTarget = 'build' | 'dev'\nexport type BooleanOrBuildTarget = boolean | BuildTarget\nexport type ModuleName = keyof typeof stdLibBrowser\nexport type ModuleNameWithoutNodePrefix<T = ModuleName> = T extends `node:${infer P}` ? P : never\n\nexport type PolyfillOptions = {\n  /**\n   * Includes specific modules. If empty, includes all modules\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   include: ['fs', 'path'],\n   * })\n   * ```\n  */\n  include?: ModuleNameWithoutNodePrefix[],\n  /**\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   exclude: ['fs', 'path'],\n   * })\n   * ```\n   */\n  exclude?: ModuleNameWithoutNodePrefix[],\n  /**\n   * Specify whether specific globals should be polyfilled.\n   *\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   globals: {\n   *     Buffer: false,\n   *     global: true,\n   *     process: 'build',\n   *   },\n   * })\n   * ```\n   */\n  globals?: {\n    Buffer?: BooleanOrBuildTarget,\n    global?: BooleanOrBuildTarget,\n    process?: BooleanOrBuildTarget,\n  },\n  /**\n   * Specify alternative modules to use in place of the default polyfills.\n   *\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   overrides: {\n   *     fs: 'memfs',\n   *   },\n   * })\n   * ```\n   */\n  overrides?: { [Key in ModuleNameWithoutNodePrefix]?: string },\n  /**\n   * Specify whether the Node protocol version of an import (e.g. `node:buffer`) should be polyfilled too.\n   *\n   * @default true\n   */\n  protocolImports?: boolean,\n}\n\nexport type PolyfillOptionsResolved = {\n  include: ModuleNameWithoutNodePrefix[],\n  exclude: ModuleNameWithoutNodePrefix[],\n  globals: {\n    Buffer: BooleanOrBuildTarget,\n    global: BooleanOrBuildTarget,\n    process: BooleanOrBuildTarget,\n  },\n  overrides: { [Key in ModuleNameWithoutNodePrefix]?: string },\n  protocolImports: boolean,\n}\n\nconst globalShimBanners = {\n  buffer: [\n    `import __buffer_polyfill from 'vite-plugin-node-polyfills/shims/buffer'`,\n    `globalThis.Buffer = globalThis.Buffer || __buffer_polyfill`,\n  ],\n  global: [\n    `import __global_polyfill from 'vite-plugin-node-polyfills/shims/global'`,\n    `globalThis.global = globalThis.global || __global_polyfill`,\n  ],\n  process: [\n    `import __process_polyfill from 'vite-plugin-node-polyfills/shims/process'`,\n    `globalThis.process = globalThis.process || __process_polyfill`,\n  ],\n}\n\n/**\n * Returns a Vite plugin to polyfill Node's Core Modules for browser environments. Supports `node:` protocol imports.\n *\n * @example\n *\n * ```ts\n * // vite.config.ts\n * import { defineConfig } from 'vite'\n * import { nodePolyfills } from 'vite-plugin-node-polyfills'\n *\n * export default defineConfig({\n *   plugins: [\n *     nodePolyfills({\n *       // Specific modules that should not be polyfilled.\n *       exclude: [],\n *       // Whether to polyfill specific globals.\n *       globals: {\n *         Buffer: true, // can also be 'build', 'dev', or false\n *         global: true,\n *         process: true,\n *       },\n *       // Whether to polyfill `node:` protocol imports.\n *       protocolImports: true,\n *     }),\n *   ],\n * })\n * ```\n */\nexport const nodePolyfills = (options: PolyfillOptions = {}): Plugin => {\n  const optionsResolved: PolyfillOptionsResolved = {\n    include: [],\n    exclude: [],\n    overrides: {},\n    protocolImports: true,\n    ...options,\n    globals: {\n      Buffer: true,\n      global: true,\n      process: true,\n      ...options.globals,\n    },\n  }\n\n  const isExcluded = (moduleName: ModuleName) => {\n    if (optionsResolved.include.length > 0) {\n      return !optionsResolved.include.some((includedName) => compareModuleNames(moduleName, includedName))\n    }\n\n    return optionsResolved.exclude.some((excludedName) => compareModuleNames(moduleName, excludedName))\n  }\n\n  const toOverride = (name: ModuleNameWithoutNodePrefix): string | void => {\n    if (isEnabled(optionsResolved.globals.Buffer, 'dev') && /^buffer$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/buffer'\n    }\n\n    if (isEnabled(optionsResolved.globals.global, 'dev') && /^global$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/global'\n    }\n\n    if (isEnabled(optionsResolved.globals.process, 'dev') && /^process$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/process'\n    }\n\n    if (name in optionsResolved.overrides) {\n      return optionsResolved.overrides[name]\n    }\n  }\n\n  const polyfills = (Object.entries(stdLibBrowser) as Array<[ModuleName, string]>).reduce<Record<ModuleName, string>>((included, [name, value]) => {\n    if (!optionsResolved.protocolImports) {\n      if (isNodeProtocolImport(name)) {\n        return included\n      }\n    }\n\n    if (!isExcluded(name)) {\n      included[name] = toOverride(withoutNodeProtocol(name)) || value\n    }\n\n    return included\n  }, {} as Record<ModuleName, string>)\n\n  const require = createRequire(import.meta.url)\n  const globalShimPaths = [\n    ...((isEnabled(optionsResolved.globals.Buffer, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/buffer')] : []),\n    ...((isEnabled(optionsResolved.globals.global, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/global')] : []),\n    ...((isEnabled(optionsResolved.globals.process, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/process')] : []),\n  ]\n\n  const globalShimsBanner = [\n    ...((isEnabled(optionsResolved.globals.Buffer, 'dev')) ? globalShimBanners.buffer : []),\n    ...((isEnabled(optionsResolved.globals.global, 'dev')) ? globalShimBanners.global : []),\n    ...((isEnabled(optionsResolved.globals.process, 'dev')) ? globalShimBanners.process : []),\n    ``,\n  ].join('\\n')\n\n  return {\n    name: 'vite-plugin-node-polyfills',\n    config(config, env) {\n      const isDev = env.command === 'serve'\n      // @ts-expect-error - this.meta.rolldownVersion only exists with rolldown-vite 7+\n      const isRolldownVite = !!this?.meta?.rolldownVersion\n\n      // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L203-L209\n      const defines = {\n        ...((isDev && isEnabled(optionsResolved.globals.Buffer, 'dev')) ? { Buffer: 'Buffer' } : {}),\n        ...((isDev && isEnabled(optionsResolved.globals.global, 'dev')) ? { global: 'global' } : {}),\n        ...((isDev && isEnabled(optionsResolved.globals.process, 'dev')) ? { process: 'process' } : {}),\n      }\n\n      const shimsToInject = {\n        // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md#vite\n        ...(isEnabled(optionsResolved.globals.Buffer, 'build') ? { Buffer: 'vite-plugin-node-polyfills/shims/buffer' } : {}),\n        ...(isEnabled(optionsResolved.globals.global, 'build') ? { global: 'vite-plugin-node-polyfills/shims/global' } : {}),\n        ...(isEnabled(optionsResolved.globals.process, 'build') ? { process: 'vite-plugin-node-polyfills/shims/process' } : {}),\n      }\n\n      return {\n        build: {\n          rollupOptions: {\n            onwarn: (warning, rollupWarn) => {\n              handleCircularDependancyWarning(warning, () => {\n                if (config.build?.rollupOptions?.onwarn) {\n                  return config.build.rollupOptions.onwarn(warning, rollupWarn)\n                }\n\n                rollupWarn(warning)\n              })\n            },\n            ...Object.keys(shimsToInject).length > 0\n              ? isRolldownVite\n                ? { inject: shimsToInject }\n                : { plugins: [inject(shimsToInject)] }\n              : {},\n          },\n        },\n        esbuild: {\n          // In dev, the global polyfills need to be injected as a banner in order for isolated scripts (such as Vue SFCs) to have access to them.\n          banner: isDev ? globalShimsBanner : undefined,\n        },\n        optimizeDeps: {\n          exclude: [\n            ...globalShimPaths,\n          ],\n          ...isRolldownVite\n            ? {\n                rollupOptions: {\n                  define: defines,\n                  resolve: {\n                    // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L150\n                    alias: {\n                      ...polyfills,\n                    },\n                  },\n                  plugins: [\n                    {\n                      name: 'vite-plugin-node-polyfills:optimizer',\n                      banner: isDev ? globalShimsBanner : undefined,\n                    },\n                  ],\n                },\n              }\n            : {\n                esbuildOptions: {\n                  banner: isDev ? { js: globalShimsBanner } : undefined,\n                  define: defines,\n                  inject: [\n                    ...globalShimPaths,\n                  ],\n                  plugins: [\n                    esbuildPlugin(polyfills),\n                    // Supress the 'injected path \"...\" cannot be marked as external' error in Vite 4 (emitted by esbuild).\n                    // https://github.com/evanw/esbuild/blob/edede3c49ad6adddc6ea5b3c78c6ea7507e03020/internal/bundler/bundler.go#L1469\n                    {\n                      name: 'vite-plugin-node-polyfills-shims-resolver',\n                      setup(build) {\n                        for (const globalShimPath of globalShimPaths) {\n                          const globalShimsFilter = toRegExp(globalShimPath)\n\n                          // https://esbuild.github.io/plugins/#on-resolve\n                          build.onResolve({ filter: globalShimsFilter }, () => {\n                            return {\n                              // https://github.com/evanw/esbuild/blob/edede3c49ad6adddc6ea5b3c78c6ea7507e03020/internal/bundler/bundler.go#L1468\n                              external: false,\n                              path: globalShimPath,\n                            }\n                          })\n                        }\n                      },\n                    },\n                  ],\n                },\n              },\n        },\n        resolve: {\n          // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L150\n          alias: {\n            ...polyfills,\n          },\n        },\n      }\n    },\n  }\n}\n"],"names":["compareModuleNames","moduleA","moduleB","withoutNodeProtocol","isEnabled","value","mode","isNodeProtocolImport","name","toRegExp","text","escapedText","globalShimBanners","nodePolyfills","options","optionsResolved","isExcluded","moduleName","includedName","excludedName","toOverride","polyfills","stdLibBrowser","included","require","createRequire","_documentCurrentScript","globalShimPaths","globalShimsBanner","config","env","isDev","isRolldownVite","defines","shimsToInject","warning","rollupWarn","handleCircularDependancyWarning","inject","esbuildPlugin","build","globalShimPath","globalShimsFilter"],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"index.cjs","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["import type { BooleanOrBuildTarget, ModuleName, ModuleNameWithoutNodePrefix } from './index'\n\nexport const compareModuleNames = (moduleA: ModuleName, moduleB: ModuleName) => {\n  return withoutNodeProtocol(moduleA) === withoutNodeProtocol(moduleB)\n}\n\nexport const isEnabled = (value: BooleanOrBuildTarget, mode: 'build' | 'dev') => {\n  if (!value) return false\n  if (value === true) return true\n\n  return value === mode\n}\n\nexport const isNodeProtocolImport = (name: string) => {\n  return name.startsWith('node:')\n}\n\nexport const toRegExp = (text: string) => {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#escaping\n  const escapedText = text.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n\n  return new RegExp(`^${escapedText}$`)\n}\n\nexport const withoutNodeProtocol = (name: ModuleName): ModuleNameWithoutNodePrefix => {\n  return name.replace(/^node:/, '') as ModuleNameWithoutNodePrefix\n}\n","import { createRequire } from 'node:module'\nimport inject from '@rollup/plugin-inject'\nimport stdLibBrowser from 'node-stdlib-browser'\nimport { handleCircularDependancyWarning } from 'node-stdlib-browser/helpers/rollup/plugin'\nimport esbuildPlugin from 'node-stdlib-browser/helpers/esbuild/plugin'\nimport type { Plugin } from 'vite'\nimport { compareModuleNames, isEnabled, isNodeProtocolImport, toRegExp, withoutNodeProtocol } from './utils'\n\nexport type BuildTarget = 'build' | 'dev'\nexport type BooleanOrBuildTarget = boolean | BuildTarget\nexport type ModuleName = keyof typeof stdLibBrowser\nexport type ModuleNameWithoutNodePrefix<T = ModuleName> = T extends `node:${infer P}` ? P : never\n\nexport type PolyfillOptions = {\n  /**\n   * Includes specific modules. If empty, includes all modules\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   include: ['fs', 'path'],\n   * })\n   * ```\n  */\n  include?: ModuleNameWithoutNodePrefix[],\n  /**\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   exclude: ['fs', 'path'],\n   * })\n   * ```\n   */\n  exclude?: ModuleNameWithoutNodePrefix[],\n  /**\n   * Specify whether specific globals should be polyfilled.\n   *\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   globals: {\n   *     Buffer: false,\n   *     global: true,\n   *     process: 'build',\n   *   },\n   * })\n   * ```\n   */\n  globals?: {\n    Buffer?: BooleanOrBuildTarget,\n    global?: BooleanOrBuildTarget,\n    process?: BooleanOrBuildTarget,\n  },\n  /**\n   * Specify alternative modules to use in place of the default polyfills.\n   *\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   overrides: {\n   *     fs: 'memfs',\n   *   },\n   * })\n   * ```\n   */\n  overrides?: { [Key in ModuleNameWithoutNodePrefix]?: string },\n  /**\n   * Specify whether the Node protocol version of an import (e.g. `node:buffer`) should be polyfilled too.\n   *\n   * @default true\n   */\n  protocolImports?: boolean,\n}\n\nexport type PolyfillOptionsResolved = {\n  include: ModuleNameWithoutNodePrefix[],\n  exclude: ModuleNameWithoutNodePrefix[],\n  globals: {\n    Buffer: BooleanOrBuildTarget,\n    global: BooleanOrBuildTarget,\n    process: BooleanOrBuildTarget,\n  },\n  overrides: { [Key in ModuleNameWithoutNodePrefix]?: string },\n  protocolImports: boolean,\n}\n\nconst globalShimBanners = {\n  buffer: [\n    `import __buffer_polyfill from 'vite-plugin-node-polyfills/shims/buffer'`,\n    `globalThis.Buffer = globalThis.Buffer || __buffer_polyfill`,\n  ],\n  global: [\n    `import __global_polyfill from 'vite-plugin-node-polyfills/shims/global'`,\n    `globalThis.global = globalThis.global || __global_polyfill`,\n  ],\n  process: [\n    `import __process_polyfill from 'vite-plugin-node-polyfills/shims/process'`,\n    `globalThis.process = globalThis.process || __process_polyfill`,\n  ],\n}\n\n/**\n * Returns a Vite plugin to polyfill Node's Core Modules for browser environments. Supports `node:` protocol imports.\n *\n * @example\n *\n * ```ts\n * // vite.config.ts\n * import { defineConfig } from 'vite'\n * import { nodePolyfills } from 'vite-plugin-node-polyfills'\n *\n * export default defineConfig({\n *   plugins: [\n *     nodePolyfills({\n *       // Specific modules that should not be polyfilled.\n *       exclude: [],\n *       // Whether to polyfill specific globals.\n *       globals: {\n *         Buffer: true, // can also be 'build', 'dev', or false\n *         global: true,\n *         process: true,\n *       },\n *       // Whether to polyfill `node:` protocol imports.\n *       protocolImports: true,\n *     }),\n *   ],\n * })\n * ```\n */\nexport const nodePolyfills = (options: PolyfillOptions = {}): Plugin => {\n  const optionsResolved: PolyfillOptionsResolved = {\n    include: [],\n    exclude: [],\n    overrides: {},\n    protocolImports: true,\n    ...options,\n    globals: {\n      Buffer: true,\n      global: true,\n      process: true,\n      ...options.globals,\n    },\n  }\n\n  const isExcluded = (moduleName: ModuleName) => {\n    if (optionsResolved.include.length > 0) {\n      return !optionsResolved.include.some((includedName) => compareModuleNames(moduleName, includedName))\n    }\n\n    return optionsResolved.exclude.some((excludedName) => compareModuleNames(moduleName, excludedName))\n  }\n\n  const toOverride = (name: ModuleNameWithoutNodePrefix): string | void => {\n    if (isEnabled(optionsResolved.globals.Buffer, 'dev') && /^buffer$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/buffer'\n    }\n\n    if (isEnabled(optionsResolved.globals.global, 'dev') && /^global$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/global'\n    }\n\n    if (isEnabled(optionsResolved.globals.process, 'dev') && /^process$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/process'\n    }\n\n    if (name in optionsResolved.overrides) {\n      return optionsResolved.overrides[name]\n    }\n  }\n\n  const polyfills = (Object.entries(stdLibBrowser) as Array<[ModuleName, string]>).reduce<Record<ModuleName, string>>((included, [name, value]) => {\n    if (!optionsResolved.protocolImports) {\n      if (isNodeProtocolImport(name)) {\n        return included\n      }\n    }\n\n    if (!isExcluded(name)) {\n      included[name] = toOverride(withoutNodeProtocol(name)) || value\n    }\n\n    return included\n  }, {} as Record<ModuleName, string>)\n\n  const require = createRequire(import.meta.url)\n  const globalShimPaths = [\n    ...((isEnabled(optionsResolved.globals.Buffer, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/buffer')] : []),\n    ...((isEnabled(optionsResolved.globals.global, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/global')] : []),\n    ...((isEnabled(optionsResolved.globals.process, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/process')] : []),\n  ]\n\n  const globalShimsBanner = [\n    ...((isEnabled(optionsResolved.globals.Buffer, 'dev')) ? globalShimBanners.buffer : []),\n    ...((isEnabled(optionsResolved.globals.global, 'dev')) ? globalShimBanners.global : []),\n    ...((isEnabled(optionsResolved.globals.process, 'dev')) ? globalShimBanners.process : []),\n    ``,\n  ].join('\\n')\n\n  return {\n    name: 'vite-plugin-node-polyfills',\n    config(config, env) {\n      const isDev = env.command === 'serve'\n      // @ts-expect-error - this.meta.rolldownVersion only exists with rolldown-vite 7+\n      const isRolldownVite = !!this?.meta?.rolldownVersion\n\n      // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L203-L209\n      const defines = {\n        ...((isDev && isEnabled(optionsResolved.globals.Buffer, 'dev')) ? { Buffer: 'Buffer' } : {}),\n        ...((isDev && isEnabled(optionsResolved.globals.global, 'dev')) ? { global: 'global' } : {}),\n        ...((isDev && isEnabled(optionsResolved.globals.process, 'dev')) ? { process: 'process' } : {}),\n      }\n\n      const shimsToInject = {\n        // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md#vite\n        ...(isEnabled(optionsResolved.globals.Buffer, 'build') ? { Buffer: 'vite-plugin-node-polyfills/shims/buffer' } : {}),\n        ...(isEnabled(optionsResolved.globals.global, 'build') ? { global: 'vite-plugin-node-polyfills/shims/global' } : {}),\n        ...(isEnabled(optionsResolved.globals.process, 'build') ? { process: 'vite-plugin-node-polyfills/shims/process' } : {}),\n      }\n\n      // Create a map of shim import paths to their resolved absolute paths\n      const shimImportMap = new Map<string, string>()\n      if (isEnabled(optionsResolved.globals.Buffer, 'build')) {\n        shimImportMap.set('vite-plugin-node-polyfills/shims/buffer', require.resolve('vite-plugin-node-polyfills/shims/buffer'))\n      }\n      if (isEnabled(optionsResolved.globals.global, 'build')) {\n        shimImportMap.set('vite-plugin-node-polyfills/shims/global', require.resolve('vite-plugin-node-polyfills/shims/global'))\n      }\n      if (isEnabled(optionsResolved.globals.process, 'build')) {\n        shimImportMap.set('vite-plugin-node-polyfills/shims/process', require.resolve('vite-plugin-node-polyfills/shims/process'))\n      }\n\n      // Plugin to resolve shim imports during build\n      const shimsResolverPlugin = shimImportMap.size > 0 ? {\n        name: 'vite-plugin-node-polyfills:shims-resolver',\n        resolveId(source: string) {\n          if (shimImportMap.has(source)) {\n            return { id: shimImportMap.get(source)!, external: false }\n          }\n          return null\n        },\n      } : null\n\n      return {\n        build: {\n          rollupOptions: {\n            onwarn: (warning, rollupWarn) => {\n              handleCircularDependancyWarning(warning, () => {\n                if (config.build?.rollupOptions?.onwarn) {\n                  return config.build.rollupOptions.onwarn(warning, rollupWarn)\n                }\n\n                rollupWarn(warning)\n              })\n            },\n            ...Object.keys(shimsToInject).length > 0\n              ? isRolldownVite\n                ? { inject: shimsToInject }\n                : { plugins: [inject(shimsToInject), ...(shimsResolverPlugin ? [shimsResolverPlugin] : [])] }\n              : {},\n          },\n        },\n        esbuild: {\n          // In dev, the global polyfills need to be injected as a banner in order for isolated scripts (such as Vue SFCs) to have access to them.\n          banner: isDev ? globalShimsBanner : undefined,\n        },\n        optimizeDeps: {\n          exclude: [\n            ...globalShimPaths,\n          ],\n          ...isRolldownVite\n            ? {\n                rollupOptions: {\n                  define: defines,\n                  resolve: {\n                    // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L150\n                    alias: {\n                      ...polyfills,\n                    },\n                  },\n                  plugins: [\n                    {\n                      name: 'vite-plugin-node-polyfills:optimizer',\n                      banner: isDev ? globalShimsBanner : undefined,\n                    },\n                  ],\n                },\n              }\n            : {\n                esbuildOptions: {\n                  banner: isDev ? { js: globalShimsBanner } : undefined,\n                  define: defines,\n                  inject: [\n                    ...globalShimPaths,\n                  ],\n                  plugins: [\n                    esbuildPlugin(polyfills),\n                    // Supress the 'injected path \"...\" cannot be marked as external' error in Vite 4 (emitted by esbuild).\n                    // https://github.com/evanw/esbuild/blob/edede3c49ad6adddc6ea5b3c78c6ea7507e03020/internal/bundler/bundler.go#L1469\n                    {\n                      name: 'vite-plugin-node-polyfills-shims-resolver',\n                      setup(build) {\n                        for (const globalShimPath of globalShimPaths) {\n                          const globalShimsFilter = toRegExp(globalShimPath)\n\n                          // https://esbuild.github.io/plugins/#on-resolve\n                          build.onResolve({ filter: globalShimsFilter }, () => {\n                            return {\n                              // https://github.com/evanw/esbuild/blob/edede3c49ad6adddc6ea5b3c78c6ea7507e03020/internal/bundler/bundler.go#L1468\n                              external: false,\n                              path: globalShimPath,\n                            }\n                          })\n                        }\n                      },\n                    },\n                  ],\n                },\n              },\n        },\n        resolve: {\n          // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L150\n          alias: {\n            ...polyfills,\n          },\n        },\n      }\n    },\n  }\n}\n"],"names":["compareModuleNames","moduleA","moduleB","withoutNodeProtocol","isEnabled","value","mode","isNodeProtocolImport","name","toRegExp","text","escapedText","globalShimBanners","nodePolyfills","options","optionsResolved","isExcluded","moduleName","includedName","excludedName","toOverride","polyfills","stdLibBrowser","included","require","createRequire","_documentCurrentScript","globalShimPaths","globalShimsBanner","config","env","isDev","isRolldownVite","defines","shimsToInject","shimImportMap","shimsResolverPlugin","source","warning","rollupWarn","handleCircularDependancyWarning","inject","esbuildPlugin","build","globalShimPath","globalShimsFilter"],"mappings":"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"}
\ No newline at end of file
diff --git a/dist/index.js b/dist/index.js
index 5795ac8a8c2da559d7a5ea83a0c7f116d32d47ad..4c3453dc5cac75745ac90959dfc69b8eb3c6302e 100644
--- a/dist/index.js
+++ b/dist/index.js
@@ -1,12 +1,12 @@
-import { createRequire as B } from "node:module";
-import x from "@rollup/plugin-inject";
-import j from "node-stdlib-browser";
-import { handleCircularDependancyWarning as O } from "node-stdlib-browser/helpers/rollup/plugin";
-import T from "node-stdlib-browser/helpers/esbuild/plugin";
-const v = (s, l) => c(s) === c(l), o = (s, l) => s ? s === !0 ? !0 : s === l : !1, $ = (s) => s.startsWith("node:"), w = (s) => {
+import { createRequire as j } from "node:module";
+import O from "@rollup/plugin-inject";
+import T from "node-stdlib-browser";
+import { handleCircularDependancyWarning as w } from "node-stdlib-browser/helpers/rollup/plugin";
+import P from "node-stdlib-browser/helpers/esbuild/plugin";
+const y = (s, l) => c(s) === c(l), e = (s, l) => s ? s === !0 ? !0 : s === l : !1, R = (s) => s.startsWith("node:"), $ = (s) => {
   const l = s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
   return new RegExp(`^${l}$`);
-}, c = (s) => s.replace(/^node:/, ""), g = {
+}, c = (s) => s.replace(/^node:/, ""), d = {
   buffer: [
     "import __buffer_polyfill from 'vite-plugin-node-polyfills/shims/buffer'",
     "globalThis.Buffer = globalThis.Buffer || __buffer_polyfill"
@@ -19,7 +19,7 @@ const v = (s, l) => c(s) === c(l), o = (s, l) => s ? s === !0 ? !0 : s === l : !
     "import __process_polyfill from 'vite-plugin-node-polyfills/shims/process'",
     "globalThis.process = globalThis.process || __process_polyfill"
   ]
-}, D = (s = {}) => {
+}, M = (s = {}) => {
   const l = {
     include: [],
     exclude: [],
@@ -32,96 +32,103 @@ const v = (s, l) => c(s) === c(l), o = (s, l) => s ? s === !0 ? !0 : s === l : !
       process: !0,
       ...s.globals
     }
-  }, h = (e) => l.include.length > 0 ? !l.include.some((r) => v(e, r)) : l.exclude.some((r) => v(e, r)), y = (e) => {
-    if (o(l.globals.Buffer, "dev") && /^buffer$/.test(e))
+  }, _ = (o) => l.include.length > 0 ? !l.include.some((i) => y(o, i)) : l.exclude.some((i) => y(o, i)), B = (o) => {
+    if (e(l.globals.Buffer, "dev") && /^buffer$/.test(o))
       return "vite-plugin-node-polyfills/shims/buffer";
-    if (o(l.globals.global, "dev") && /^global$/.test(e))
+    if (e(l.globals.global, "dev") && /^global$/.test(o))
       return "vite-plugin-node-polyfills/shims/global";
-    if (o(l.globals.process, "dev") && /^process$/.test(e))
+    if (e(l.globals.process, "dev") && /^process$/.test(o))
       return "vite-plugin-node-polyfills/shims/process";
-    if (e in l.overrides)
-      return l.overrides[e];
-  }, p = Object.entries(j).reduce((e, [r, i]) => (!l.protocolImports && $(r) || h(r) || (e[r] = y(c(r)) || i), e), {}), f = B(import.meta.url), u = [
-    ...o(l.globals.Buffer, "dev") ? [f.resolve("vite-plugin-node-polyfills/shims/buffer")] : [],
-    ...o(l.globals.global, "dev") ? [f.resolve("vite-plugin-node-polyfills/shims/global")] : [],
-    ...o(l.globals.process, "dev") ? [f.resolve("vite-plugin-node-polyfills/shims/process")] : []
+    if (o in l.overrides)
+      return l.overrides[o];
+  }, u = Object.entries(T).reduce((o, [i, r]) => (!l.protocolImports && R(i) || _(i) || (o[i] = B(c(i)) || r), o), {}), t = j(import.meta.url), g = [
+    ...e(l.globals.Buffer, "dev") ? [t.resolve("vite-plugin-node-polyfills/shims/buffer")] : [],
+    ...e(l.globals.global, "dev") ? [t.resolve("vite-plugin-node-polyfills/shims/global")] : [],
+    ...e(l.globals.process, "dev") ? [t.resolve("vite-plugin-node-polyfills/shims/process")] : []
   ], b = [
-    ...o(l.globals.Buffer, "dev") ? g.buffer : [],
-    ...o(l.globals.global, "dev") ? g.global : [],
-    ...o(l.globals.process, "dev") ? g.process : [],
+    ...e(l.globals.Buffer, "dev") ? d.buffer : [],
+    ...e(l.globals.global, "dev") ? d.global : [],
+    ...e(l.globals.process, "dev") ? d.process : [],
     ""
   ].join(`
 `);
   return {
     name: "vite-plugin-node-polyfills",
-    config(e, r) {
-      const i = r.command === "serve", d = !!this?.meta?.rolldownVersion, m = {
-        ...i && o(l.globals.Buffer, "dev") ? { Buffer: "Buffer" } : {},
-        ...i && o(l.globals.global, "dev") ? { global: "global" } : {},
-        ...i && o(l.globals.process, "dev") ? { process: "process" } : {}
+    config(o, i) {
+      const r = i.command === "serve", v = !!this?.meta?.rolldownVersion, m = {
+        ...r && e(l.globals.Buffer, "dev") ? { Buffer: "Buffer" } : {},
+        ...r && e(l.globals.global, "dev") ? { global: "global" } : {},
+        ...r && e(l.globals.process, "dev") ? { process: "process" } : {}
       }, a = {
         // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md#vite
-        ...o(l.globals.Buffer, "build") ? { Buffer: "vite-plugin-node-polyfills/shims/buffer" } : {},
-        ...o(l.globals.global, "build") ? { global: "vite-plugin-node-polyfills/shims/global" } : {},
-        ...o(l.globals.process, "build") ? { process: "vite-plugin-node-polyfills/shims/process" } : {}
-      };
+        ...e(l.globals.Buffer, "build") ? { Buffer: "vite-plugin-node-polyfills/shims/buffer" } : {},
+        ...e(l.globals.global, "build") ? { global: "vite-plugin-node-polyfills/shims/global" } : {},
+        ...e(l.globals.process, "build") ? { process: "vite-plugin-node-polyfills/shims/process" } : {}
+      }, p = /* @__PURE__ */ new Map();
+      e(l.globals.Buffer, "build") && p.set("vite-plugin-node-polyfills/shims/buffer", t.resolve("vite-plugin-node-polyfills/shims/buffer")), e(l.globals.global, "build") && p.set("vite-plugin-node-polyfills/shims/global", t.resolve("vite-plugin-node-polyfills/shims/global")), e(l.globals.process, "build") && p.set("vite-plugin-node-polyfills/shims/process", t.resolve("vite-plugin-node-polyfills/shims/process"));
+      const h = p.size > 0 ? {
+        name: "vite-plugin-node-polyfills:shims-resolver",
+        resolveId(n) {
+          return p.has(n) ? { id: p.get(n), external: !1 } : null;
+        }
+      } : null;
       return {
         build: {
           rollupOptions: {
-            onwarn: (t, n) => {
-              O(t, () => {
-                if (e.build?.rollupOptions?.onwarn)
-                  return e.build.rollupOptions.onwarn(t, n);
-                n(t);
+            onwarn: (n, f) => {
+              w(n, () => {
+                if (o.build?.rollupOptions?.onwarn)
+                  return o.build.rollupOptions.onwarn(n, f);
+                f(n);
               });
             },
-            ...Object.keys(a).length > 0 ? d ? { inject: a } : { plugins: [x(a)] } : {}
+            ...Object.keys(a).length > 0 ? v ? { inject: a } : { plugins: [O(a), ...h ? [h] : []] } : {}
           }
         },
         esbuild: {
           // In dev, the global polyfills need to be injected as a banner in order for isolated scripts (such as Vue SFCs) to have access to them.
-          banner: i ? b : void 0
+          banner: r ? b : void 0
         },
         optimizeDeps: {
           exclude: [
-            ...u
+            ...g
           ],
-          ...d ? {
+          ...v ? {
             rollupOptions: {
               define: m,
               resolve: {
                 // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L150
                 alias: {
-                  ...p
+                  ...u
                 }
               },
               plugins: [
                 {
                   name: "vite-plugin-node-polyfills:optimizer",
-                  banner: i ? b : void 0
+                  banner: r ? b : void 0
                 }
               ]
             }
           } : {
             esbuildOptions: {
-              banner: i ? { js: b } : void 0,
+              banner: r ? { js: b } : void 0,
               define: m,
               inject: [
-                ...u
+                ...g
               ],
               plugins: [
-                T(p),
+                P(u),
                 // Supress the 'injected path "..." cannot be marked as external' error in Vite 4 (emitted by esbuild).
                 // https://github.com/evanw/esbuild/blob/edede3c49ad6adddc6ea5b3c78c6ea7507e03020/internal/bundler/bundler.go#L1469
                 {
                   name: "vite-plugin-node-polyfills-shims-resolver",
-                  setup(t) {
-                    for (const n of u) {
-                      const _ = w(n);
-                      t.onResolve({ filter: _ }, () => ({
+                  setup(n) {
+                    for (const f of g) {
+                      const x = $(f);
+                      n.onResolve({ filter: x }, () => ({
                         // https://github.com/evanw/esbuild/blob/edede3c49ad6adddc6ea5b3c78c6ea7507e03020/internal/bundler/bundler.go#L1468
                         external: !1,
-                        path: n
+                        path: f
                       }));
                     }
                   }
@@ -133,7 +140,7 @@ const v = (s, l) => c(s) === c(l), o = (s, l) => s ? s === !0 ? !0 : s === l : !
         resolve: {
           // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L150
           alias: {
-            ...p
+            ...u
           }
         }
       };
@@ -141,6 +148,6 @@ const v = (s, l) => c(s) === c(l), o = (s, l) => s ? s === !0 ? !0 : s === l : !
   };
 };
 export {
-  D as nodePolyfills
+  M as nodePolyfills
 };
 //# sourceMappingURL=index.js.map
diff --git a/dist/index.js.map b/dist/index.js.map
index 82e2c4ffccccf44b8eba82d171ec600bd48ace86..bed5c99baa6b93838c2ae7da015d3bba62559b10 100644
--- a/dist/index.js.map
+++ b/dist/index.js.map
@@ -1 +1 @@
-{"version":3,"file":"index.js","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["import type { BooleanOrBuildTarget, ModuleName, ModuleNameWithoutNodePrefix } from './index'\n\nexport const compareModuleNames = (moduleA: ModuleName, moduleB: ModuleName) => {\n  return withoutNodeProtocol(moduleA) === withoutNodeProtocol(moduleB)\n}\n\nexport const isEnabled = (value: BooleanOrBuildTarget, mode: 'build' | 'dev') => {\n  if (!value) return false\n  if (value === true) return true\n\n  return value === mode\n}\n\nexport const isNodeProtocolImport = (name: string) => {\n  return name.startsWith('node:')\n}\n\nexport const toRegExp = (text: string) => {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#escaping\n  const escapedText = text.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n\n  return new RegExp(`^${escapedText}$`)\n}\n\nexport const withoutNodeProtocol = (name: ModuleName): ModuleNameWithoutNodePrefix => {\n  return name.replace(/^node:/, '') as ModuleNameWithoutNodePrefix\n}\n","import { createRequire } from 'node:module'\nimport inject from '@rollup/plugin-inject'\nimport stdLibBrowser from 'node-stdlib-browser'\nimport { handleCircularDependancyWarning } from 'node-stdlib-browser/helpers/rollup/plugin'\nimport esbuildPlugin from 'node-stdlib-browser/helpers/esbuild/plugin'\nimport type { Plugin } from 'vite'\nimport { compareModuleNames, isEnabled, isNodeProtocolImport, toRegExp, withoutNodeProtocol } from './utils'\n\nexport type BuildTarget = 'build' | 'dev'\nexport type BooleanOrBuildTarget = boolean | BuildTarget\nexport type ModuleName = keyof typeof stdLibBrowser\nexport type ModuleNameWithoutNodePrefix<T = ModuleName> = T extends `node:${infer P}` ? P : never\n\nexport type PolyfillOptions = {\n  /**\n   * Includes specific modules. If empty, includes all modules\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   include: ['fs', 'path'],\n   * })\n   * ```\n  */\n  include?: ModuleNameWithoutNodePrefix[],\n  /**\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   exclude: ['fs', 'path'],\n   * })\n   * ```\n   */\n  exclude?: ModuleNameWithoutNodePrefix[],\n  /**\n   * Specify whether specific globals should be polyfilled.\n   *\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   globals: {\n   *     Buffer: false,\n   *     global: true,\n   *     process: 'build',\n   *   },\n   * })\n   * ```\n   */\n  globals?: {\n    Buffer?: BooleanOrBuildTarget,\n    global?: BooleanOrBuildTarget,\n    process?: BooleanOrBuildTarget,\n  },\n  /**\n   * Specify alternative modules to use in place of the default polyfills.\n   *\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   overrides: {\n   *     fs: 'memfs',\n   *   },\n   * })\n   * ```\n   */\n  overrides?: { [Key in ModuleNameWithoutNodePrefix]?: string },\n  /**\n   * Specify whether the Node protocol version of an import (e.g. `node:buffer`) should be polyfilled too.\n   *\n   * @default true\n   */\n  protocolImports?: boolean,\n}\n\nexport type PolyfillOptionsResolved = {\n  include: ModuleNameWithoutNodePrefix[],\n  exclude: ModuleNameWithoutNodePrefix[],\n  globals: {\n    Buffer: BooleanOrBuildTarget,\n    global: BooleanOrBuildTarget,\n    process: BooleanOrBuildTarget,\n  },\n  overrides: { [Key in ModuleNameWithoutNodePrefix]?: string },\n  protocolImports: boolean,\n}\n\nconst globalShimBanners = {\n  buffer: [\n    `import __buffer_polyfill from 'vite-plugin-node-polyfills/shims/buffer'`,\n    `globalThis.Buffer = globalThis.Buffer || __buffer_polyfill`,\n  ],\n  global: [\n    `import __global_polyfill from 'vite-plugin-node-polyfills/shims/global'`,\n    `globalThis.global = globalThis.global || __global_polyfill`,\n  ],\n  process: [\n    `import __process_polyfill from 'vite-plugin-node-polyfills/shims/process'`,\n    `globalThis.process = globalThis.process || __process_polyfill`,\n  ],\n}\n\n/**\n * Returns a Vite plugin to polyfill Node's Core Modules for browser environments. Supports `node:` protocol imports.\n *\n * @example\n *\n * ```ts\n * // vite.config.ts\n * import { defineConfig } from 'vite'\n * import { nodePolyfills } from 'vite-plugin-node-polyfills'\n *\n * export default defineConfig({\n *   plugins: [\n *     nodePolyfills({\n *       // Specific modules that should not be polyfilled.\n *       exclude: [],\n *       // Whether to polyfill specific globals.\n *       globals: {\n *         Buffer: true, // can also be 'build', 'dev', or false\n *         global: true,\n *         process: true,\n *       },\n *       // Whether to polyfill `node:` protocol imports.\n *       protocolImports: true,\n *     }),\n *   ],\n * })\n * ```\n */\nexport const nodePolyfills = (options: PolyfillOptions = {}): Plugin => {\n  const optionsResolved: PolyfillOptionsResolved = {\n    include: [],\n    exclude: [],\n    overrides: {},\n    protocolImports: true,\n    ...options,\n    globals: {\n      Buffer: true,\n      global: true,\n      process: true,\n      ...options.globals,\n    },\n  }\n\n  const isExcluded = (moduleName: ModuleName) => {\n    if (optionsResolved.include.length > 0) {\n      return !optionsResolved.include.some((includedName) => compareModuleNames(moduleName, includedName))\n    }\n\n    return optionsResolved.exclude.some((excludedName) => compareModuleNames(moduleName, excludedName))\n  }\n\n  const toOverride = (name: ModuleNameWithoutNodePrefix): string | void => {\n    if (isEnabled(optionsResolved.globals.Buffer, 'dev') && /^buffer$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/buffer'\n    }\n\n    if (isEnabled(optionsResolved.globals.global, 'dev') && /^global$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/global'\n    }\n\n    if (isEnabled(optionsResolved.globals.process, 'dev') && /^process$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/process'\n    }\n\n    if (name in optionsResolved.overrides) {\n      return optionsResolved.overrides[name]\n    }\n  }\n\n  const polyfills = (Object.entries(stdLibBrowser) as Array<[ModuleName, string]>).reduce<Record<ModuleName, string>>((included, [name, value]) => {\n    if (!optionsResolved.protocolImports) {\n      if (isNodeProtocolImport(name)) {\n        return included\n      }\n    }\n\n    if (!isExcluded(name)) {\n      included[name] = toOverride(withoutNodeProtocol(name)) || value\n    }\n\n    return included\n  }, {} as Record<ModuleName, string>)\n\n  const require = createRequire(import.meta.url)\n  const globalShimPaths = [\n    ...((isEnabled(optionsResolved.globals.Buffer, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/buffer')] : []),\n    ...((isEnabled(optionsResolved.globals.global, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/global')] : []),\n    ...((isEnabled(optionsResolved.globals.process, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/process')] : []),\n  ]\n\n  const globalShimsBanner = [\n    ...((isEnabled(optionsResolved.globals.Buffer, 'dev')) ? globalShimBanners.buffer : []),\n    ...((isEnabled(optionsResolved.globals.global, 'dev')) ? globalShimBanners.global : []),\n    ...((isEnabled(optionsResolved.globals.process, 'dev')) ? globalShimBanners.process : []),\n    ``,\n  ].join('\\n')\n\n  return {\n    name: 'vite-plugin-node-polyfills',\n    config(config, env) {\n      const isDev = env.command === 'serve'\n      // @ts-expect-error - this.meta.rolldownVersion only exists with rolldown-vite 7+\n      const isRolldownVite = !!this?.meta?.rolldownVersion\n\n      // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L203-L209\n      const defines = {\n        ...((isDev && isEnabled(optionsResolved.globals.Buffer, 'dev')) ? { Buffer: 'Buffer' } : {}),\n        ...((isDev && isEnabled(optionsResolved.globals.global, 'dev')) ? { global: 'global' } : {}),\n        ...((isDev && isEnabled(optionsResolved.globals.process, 'dev')) ? { process: 'process' } : {}),\n      }\n\n      const shimsToInject = {\n        // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md#vite\n        ...(isEnabled(optionsResolved.globals.Buffer, 'build') ? { Buffer: 'vite-plugin-node-polyfills/shims/buffer' } : {}),\n        ...(isEnabled(optionsResolved.globals.global, 'build') ? { global: 'vite-plugin-node-polyfills/shims/global' } : {}),\n        ...(isEnabled(optionsResolved.globals.process, 'build') ? { process: 'vite-plugin-node-polyfills/shims/process' } : {}),\n      }\n\n      return {\n        build: {\n          rollupOptions: {\n            onwarn: (warning, rollupWarn) => {\n              handleCircularDependancyWarning(warning, () => {\n                if (config.build?.rollupOptions?.onwarn) {\n                  return config.build.rollupOptions.onwarn(warning, rollupWarn)\n                }\n\n                rollupWarn(warning)\n              })\n            },\n            ...Object.keys(shimsToInject).length > 0\n              ? isRolldownVite\n                ? { inject: shimsToInject }\n                : { plugins: [inject(shimsToInject)] }\n              : {},\n          },\n        },\n        esbuild: {\n          // In dev, the global polyfills need to be injected as a banner in order for isolated scripts (such as Vue SFCs) to have access to them.\n          banner: isDev ? globalShimsBanner : undefined,\n        },\n        optimizeDeps: {\n          exclude: [\n            ...globalShimPaths,\n          ],\n          ...isRolldownVite\n            ? {\n                rollupOptions: {\n                  define: defines,\n                  resolve: {\n                    // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L150\n                    alias: {\n                      ...polyfills,\n                    },\n                  },\n                  plugins: [\n                    {\n                      name: 'vite-plugin-node-polyfills:optimizer',\n                      banner: isDev ? globalShimsBanner : undefined,\n                    },\n                  ],\n                },\n              }\n            : {\n                esbuildOptions: {\n                  banner: isDev ? { js: globalShimsBanner } : undefined,\n                  define: defines,\n                  inject: [\n                    ...globalShimPaths,\n                  ],\n                  plugins: [\n                    esbuildPlugin(polyfills),\n                    // Supress the 'injected path \"...\" cannot be marked as external' error in Vite 4 (emitted by esbuild).\n                    // https://github.com/evanw/esbuild/blob/edede3c49ad6adddc6ea5b3c78c6ea7507e03020/internal/bundler/bundler.go#L1469\n                    {\n                      name: 'vite-plugin-node-polyfills-shims-resolver',\n                      setup(build) {\n                        for (const globalShimPath of globalShimPaths) {\n                          const globalShimsFilter = toRegExp(globalShimPath)\n\n                          // https://esbuild.github.io/plugins/#on-resolve\n                          build.onResolve({ filter: globalShimsFilter }, () => {\n                            return {\n                              // https://github.com/evanw/esbuild/blob/edede3c49ad6adddc6ea5b3c78c6ea7507e03020/internal/bundler/bundler.go#L1468\n                              external: false,\n                              path: globalShimPath,\n                            }\n                          })\n                        }\n                      },\n                    },\n                  ],\n                },\n              },\n        },\n        resolve: {\n          // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L150\n          alias: {\n            ...polyfills,\n          },\n        },\n      }\n    },\n  }\n}\n"],"names":["compareModuleNames","moduleA","moduleB","withoutNodeProtocol","isEnabled","value","mode","isNodeProtocolImport","name","toRegExp","text","escapedText","globalShimBanners","nodePolyfills","options","optionsResolved","isExcluded","moduleName","includedName","excludedName","toOverride","polyfills","stdLibBrowser","included","require","createRequire","globalShimPaths","globalShimsBanner","config","env","isDev","isRolldownVite","defines","shimsToInject","warning","rollupWarn","handleCircularDependancyWarning","inject","esbuildPlugin","build","globalShimPath","globalShimsFilter"],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"index.js","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["import type { BooleanOrBuildTarget, ModuleName, ModuleNameWithoutNodePrefix } from './index'\n\nexport const compareModuleNames = (moduleA: ModuleName, moduleB: ModuleName) => {\n  return withoutNodeProtocol(moduleA) === withoutNodeProtocol(moduleB)\n}\n\nexport const isEnabled = (value: BooleanOrBuildTarget, mode: 'build' | 'dev') => {\n  if (!value) return false\n  if (value === true) return true\n\n  return value === mode\n}\n\nexport const isNodeProtocolImport = (name: string) => {\n  return name.startsWith('node:')\n}\n\nexport const toRegExp = (text: string) => {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#escaping\n  const escapedText = text.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n\n  return new RegExp(`^${escapedText}$`)\n}\n\nexport const withoutNodeProtocol = (name: ModuleName): ModuleNameWithoutNodePrefix => {\n  return name.replace(/^node:/, '') as ModuleNameWithoutNodePrefix\n}\n","import { createRequire } from 'node:module'\nimport inject from '@rollup/plugin-inject'\nimport stdLibBrowser from 'node-stdlib-browser'\nimport { handleCircularDependancyWarning } from 'node-stdlib-browser/helpers/rollup/plugin'\nimport esbuildPlugin from 'node-stdlib-browser/helpers/esbuild/plugin'\nimport type { Plugin } from 'vite'\nimport { compareModuleNames, isEnabled, isNodeProtocolImport, toRegExp, withoutNodeProtocol } from './utils'\n\nexport type BuildTarget = 'build' | 'dev'\nexport type BooleanOrBuildTarget = boolean | BuildTarget\nexport type ModuleName = keyof typeof stdLibBrowser\nexport type ModuleNameWithoutNodePrefix<T = ModuleName> = T extends `node:${infer P}` ? P : never\n\nexport type PolyfillOptions = {\n  /**\n   * Includes specific modules. If empty, includes all modules\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   include: ['fs', 'path'],\n   * })\n   * ```\n  */\n  include?: ModuleNameWithoutNodePrefix[],\n  /**\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   exclude: ['fs', 'path'],\n   * })\n   * ```\n   */\n  exclude?: ModuleNameWithoutNodePrefix[],\n  /**\n   * Specify whether specific globals should be polyfilled.\n   *\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   globals: {\n   *     Buffer: false,\n   *     global: true,\n   *     process: 'build',\n   *   },\n   * })\n   * ```\n   */\n  globals?: {\n    Buffer?: BooleanOrBuildTarget,\n    global?: BooleanOrBuildTarget,\n    process?: BooleanOrBuildTarget,\n  },\n  /**\n   * Specify alternative modules to use in place of the default polyfills.\n   *\n   * @example\n   *\n   * ```ts\n   * nodePolyfills({\n   *   overrides: {\n   *     fs: 'memfs',\n   *   },\n   * })\n   * ```\n   */\n  overrides?: { [Key in ModuleNameWithoutNodePrefix]?: string },\n  /**\n   * Specify whether the Node protocol version of an import (e.g. `node:buffer`) should be polyfilled too.\n   *\n   * @default true\n   */\n  protocolImports?: boolean,\n}\n\nexport type PolyfillOptionsResolved = {\n  include: ModuleNameWithoutNodePrefix[],\n  exclude: ModuleNameWithoutNodePrefix[],\n  globals: {\n    Buffer: BooleanOrBuildTarget,\n    global: BooleanOrBuildTarget,\n    process: BooleanOrBuildTarget,\n  },\n  overrides: { [Key in ModuleNameWithoutNodePrefix]?: string },\n  protocolImports: boolean,\n}\n\nconst globalShimBanners = {\n  buffer: [\n    `import __buffer_polyfill from 'vite-plugin-node-polyfills/shims/buffer'`,\n    `globalThis.Buffer = globalThis.Buffer || __buffer_polyfill`,\n  ],\n  global: [\n    `import __global_polyfill from 'vite-plugin-node-polyfills/shims/global'`,\n    `globalThis.global = globalThis.global || __global_polyfill`,\n  ],\n  process: [\n    `import __process_polyfill from 'vite-plugin-node-polyfills/shims/process'`,\n    `globalThis.process = globalThis.process || __process_polyfill`,\n  ],\n}\n\n/**\n * Returns a Vite plugin to polyfill Node's Core Modules for browser environments. Supports `node:` protocol imports.\n *\n * @example\n *\n * ```ts\n * // vite.config.ts\n * import { defineConfig } from 'vite'\n * import { nodePolyfills } from 'vite-plugin-node-polyfills'\n *\n * export default defineConfig({\n *   plugins: [\n *     nodePolyfills({\n *       // Specific modules that should not be polyfilled.\n *       exclude: [],\n *       // Whether to polyfill specific globals.\n *       globals: {\n *         Buffer: true, // can also be 'build', 'dev', or false\n *         global: true,\n *         process: true,\n *       },\n *       // Whether to polyfill `node:` protocol imports.\n *       protocolImports: true,\n *     }),\n *   ],\n * })\n * ```\n */\nexport const nodePolyfills = (options: PolyfillOptions = {}): Plugin => {\n  const optionsResolved: PolyfillOptionsResolved = {\n    include: [],\n    exclude: [],\n    overrides: {},\n    protocolImports: true,\n    ...options,\n    globals: {\n      Buffer: true,\n      global: true,\n      process: true,\n      ...options.globals,\n    },\n  }\n\n  const isExcluded = (moduleName: ModuleName) => {\n    if (optionsResolved.include.length > 0) {\n      return !optionsResolved.include.some((includedName) => compareModuleNames(moduleName, includedName))\n    }\n\n    return optionsResolved.exclude.some((excludedName) => compareModuleNames(moduleName, excludedName))\n  }\n\n  const toOverride = (name: ModuleNameWithoutNodePrefix): string | void => {\n    if (isEnabled(optionsResolved.globals.Buffer, 'dev') && /^buffer$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/buffer'\n    }\n\n    if (isEnabled(optionsResolved.globals.global, 'dev') && /^global$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/global'\n    }\n\n    if (isEnabled(optionsResolved.globals.process, 'dev') && /^process$/.test(name)) {\n      return 'vite-plugin-node-polyfills/shims/process'\n    }\n\n    if (name in optionsResolved.overrides) {\n      return optionsResolved.overrides[name]\n    }\n  }\n\n  const polyfills = (Object.entries(stdLibBrowser) as Array<[ModuleName, string]>).reduce<Record<ModuleName, string>>((included, [name, value]) => {\n    if (!optionsResolved.protocolImports) {\n      if (isNodeProtocolImport(name)) {\n        return included\n      }\n    }\n\n    if (!isExcluded(name)) {\n      included[name] = toOverride(withoutNodeProtocol(name)) || value\n    }\n\n    return included\n  }, {} as Record<ModuleName, string>)\n\n  const require = createRequire(import.meta.url)\n  const globalShimPaths = [\n    ...((isEnabled(optionsResolved.globals.Buffer, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/buffer')] : []),\n    ...((isEnabled(optionsResolved.globals.global, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/global')] : []),\n    ...((isEnabled(optionsResolved.globals.process, 'dev')) ? [require.resolve('vite-plugin-node-polyfills/shims/process')] : []),\n  ]\n\n  const globalShimsBanner = [\n    ...((isEnabled(optionsResolved.globals.Buffer, 'dev')) ? globalShimBanners.buffer : []),\n    ...((isEnabled(optionsResolved.globals.global, 'dev')) ? globalShimBanners.global : []),\n    ...((isEnabled(optionsResolved.globals.process, 'dev')) ? globalShimBanners.process : []),\n    ``,\n  ].join('\\n')\n\n  return {\n    name: 'vite-plugin-node-polyfills',\n    config(config, env) {\n      const isDev = env.command === 'serve'\n      // @ts-expect-error - this.meta.rolldownVersion only exists with rolldown-vite 7+\n      const isRolldownVite = !!this?.meta?.rolldownVersion\n\n      // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L203-L209\n      const defines = {\n        ...((isDev && isEnabled(optionsResolved.globals.Buffer, 'dev')) ? { Buffer: 'Buffer' } : {}),\n        ...((isDev && isEnabled(optionsResolved.globals.global, 'dev')) ? { global: 'global' } : {}),\n        ...((isDev && isEnabled(optionsResolved.globals.process, 'dev')) ? { process: 'process' } : {}),\n      }\n\n      const shimsToInject = {\n        // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md#vite\n        ...(isEnabled(optionsResolved.globals.Buffer, 'build') ? { Buffer: 'vite-plugin-node-polyfills/shims/buffer' } : {}),\n        ...(isEnabled(optionsResolved.globals.global, 'build') ? { global: 'vite-plugin-node-polyfills/shims/global' } : {}),\n        ...(isEnabled(optionsResolved.globals.process, 'build') ? { process: 'vite-plugin-node-polyfills/shims/process' } : {}),\n      }\n\n      // Create a map of shim import paths to their resolved absolute paths\n      const shimImportMap = new Map<string, string>()\n      if (isEnabled(optionsResolved.globals.Buffer, 'build')) {\n        shimImportMap.set('vite-plugin-node-polyfills/shims/buffer', require.resolve('vite-plugin-node-polyfills/shims/buffer'))\n      }\n      if (isEnabled(optionsResolved.globals.global, 'build')) {\n        shimImportMap.set('vite-plugin-node-polyfills/shims/global', require.resolve('vite-plugin-node-polyfills/shims/global'))\n      }\n      if (isEnabled(optionsResolved.globals.process, 'build')) {\n        shimImportMap.set('vite-plugin-node-polyfills/shims/process', require.resolve('vite-plugin-node-polyfills/shims/process'))\n      }\n\n      // Plugin to resolve shim imports during build\n      const shimsResolverPlugin = shimImportMap.size > 0 ? {\n        name: 'vite-plugin-node-polyfills:shims-resolver',\n        resolveId(source: string) {\n          if (shimImportMap.has(source)) {\n            return { id: shimImportMap.get(source)!, external: false }\n          }\n          return null\n        },\n      } : null\n\n      return {\n        build: {\n          rollupOptions: {\n            onwarn: (warning, rollupWarn) => {\n              handleCircularDependancyWarning(warning, () => {\n                if (config.build?.rollupOptions?.onwarn) {\n                  return config.build.rollupOptions.onwarn(warning, rollupWarn)\n                }\n\n                rollupWarn(warning)\n              })\n            },\n            ...Object.keys(shimsToInject).length > 0\n              ? isRolldownVite\n                ? { inject: shimsToInject }\n                : { plugins: [inject(shimsToInject), ...(shimsResolverPlugin ? [shimsResolverPlugin] : [])] }\n              : {},\n          },\n        },\n        esbuild: {\n          // In dev, the global polyfills need to be injected as a banner in order for isolated scripts (such as Vue SFCs) to have access to them.\n          banner: isDev ? globalShimsBanner : undefined,\n        },\n        optimizeDeps: {\n          exclude: [\n            ...globalShimPaths,\n          ],\n          ...isRolldownVite\n            ? {\n                rollupOptions: {\n                  define: defines,\n                  resolve: {\n                    // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L150\n                    alias: {\n                      ...polyfills,\n                    },\n                  },\n                  plugins: [\n                    {\n                      name: 'vite-plugin-node-polyfills:optimizer',\n                      banner: isDev ? globalShimsBanner : undefined,\n                    },\n                  ],\n                },\n              }\n            : {\n                esbuildOptions: {\n                  banner: isDev ? { js: globalShimsBanner } : undefined,\n                  define: defines,\n                  inject: [\n                    ...globalShimPaths,\n                  ],\n                  plugins: [\n                    esbuildPlugin(polyfills),\n                    // Supress the 'injected path \"...\" cannot be marked as external' error in Vite 4 (emitted by esbuild).\n                    // https://github.com/evanw/esbuild/blob/edede3c49ad6adddc6ea5b3c78c6ea7507e03020/internal/bundler/bundler.go#L1469\n                    {\n                      name: 'vite-plugin-node-polyfills-shims-resolver',\n                      setup(build) {\n                        for (const globalShimPath of globalShimPaths) {\n                          const globalShimsFilter = toRegExp(globalShimPath)\n\n                          // https://esbuild.github.io/plugins/#on-resolve\n                          build.onResolve({ filter: globalShimsFilter }, () => {\n                            return {\n                              // https://github.com/evanw/esbuild/blob/edede3c49ad6adddc6ea5b3c78c6ea7507e03020/internal/bundler/bundler.go#L1468\n                              external: false,\n                              path: globalShimPath,\n                            }\n                          })\n                        }\n                      },\n                    },\n                  ],\n                },\n              },\n        },\n        resolve: {\n          // https://github.com/niksy/node-stdlib-browser/blob/3e7cd7f3d115ac5c4593b550e7d8c4a82a0d4ac4/README.md?plain=1#L150\n          alias: {\n            ...polyfills,\n          },\n        },\n      }\n    },\n  }\n}\n"],"names":["compareModuleNames","moduleA","moduleB","withoutNodeProtocol","isEnabled","value","mode","isNodeProtocolImport","name","toRegExp","text","escapedText","globalShimBanners","nodePolyfills","options","optionsResolved","isExcluded","moduleName","includedName","excludedName","toOverride","polyfills","stdLibBrowser","included","require","createRequire","globalShimPaths","globalShimsBanner","config","env","isDev","isRolldownVite","defines","shimsToInject","shimImportMap","shimsResolverPlugin","source","warning","rollupWarn","handleCircularDependancyWarning","inject","esbuildPlugin","build","globalShimPath","globalShimsFilter"],"mappings":"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"}
